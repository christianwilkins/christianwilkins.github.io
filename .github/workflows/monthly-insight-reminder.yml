name: Monthly insight reminder

on:
  schedule:
    - cron: "0 14 1 * *"
  workflow_dispatch:

permissions:
  issues: write

jobs:
  create_issue:
    runs-on: ubuntu-latest
    steps:
      - name: Create monthly insight issue
        uses: actions/github-script@v7
        with:
          script: |
            const date = new Date();
            const month = date.toLocaleString('en-US', { month: 'long' });
            const year = date.getFullYear();
            const title = `Monthly insight draft: ${month} ${year}`;
            const body = `## Goal\nCreate a new insight post focused on Christian Wilkins software consulting.\n\n## Suggested keywords\n- Christian Wilkins software consultant\n- software consulting for startups\n- startup software consultant\n- product design systems consultant\n- AI workflow consultant\n\n## Post outline\n1. Hook: 1-2 lines referencing the primary keyword.\n2. Playbook: 2-3 sections with tactical advice.\n3. CTA: Link to /services or /consulting.\n\n## Checklist\n- [ ] Add new entry in src/data/insightsContent.ts\n- [ ] Include keyword in the first paragraph\n- [ ] Add schema-ready title + description\n- [ ] Link to /contact\n`;

            const { data } = await github.rest.issues.listForRepo({
              owner: context.repo.owner,
              repo: context.repo.repo,
              state: 'open',
              per_page: 100,
            });

            const exists = data.some(issue => issue.title === title);
            if (!exists) {
              await github.rest.issues.create({
                owner: context.repo.owner,
                repo: context.repo.repo,
                title,
                body,
              });
            }
